---------------------------------------
-- INTRANET CELU
-- \App_Data\Procedures\BemEstar\TBL_HOSPEDE_TEMPORARIO.SQL
-- # 2012-03-22 - Criação
-- Matheus Araújo
---------------------------------------

--------------------------------------------
-- PROCEDURE LOAD_LIST_HOSPEDE_TEMPORARIO --
--------------------------------------------

CREATE PROCEDURE LOAD_LIST_HOSPEDE_TEMPORARIO
(
    @P_DT_DATA_INICIO SMALLDATETIME,
    @P_DT_DATA_FIM SMALLDATETIME
)
AS
BEGIN 
    SELECT
        TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO,        
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO,
        CONVERT(VARCHAR(10), TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO, 103) AS CHR_DATA_INICIO,
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM,
        CONVERT(VARCHAR(10), TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM, 103) AS CHR_DATA_FIM,
        TBL_HOSPEDE_TEMPORARIO.CHR_EVENTO,
        TBL_HOSPEDE_TEMPORARIO.CHR_RESPONSAVEL,
        TBL_HOSPEDE_TEMPORARIO.CHR_CONTATO,
        TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PESSOAS,
        TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PERNOITE,
        TBL_HOSPEDE_TEMPORARIO.FLT_VALOR,
        TBL_HOSPEDE_TEMPORARIO.CHR_SITUACAO,
        TBL_HOSPEDE_TEMPORARIO.CHR_OBSERVACAO
    FROM
        TBL_HOSPEDE_TEMPORARIO        
    WHERE
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO BETWEEN @P_DT_DATA_INICIO AND @P_DT_DATA_FIM OR
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM BETWEEN @P_DT_DATA_INICIO AND @P_DT_DATA_FIM
    ORDER BY
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO,
        TBL_HOSPEDE_TEMPORARIO.CHR_RESPONSAVEL,
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM
END

-------------------------------------------
-- PROCEDURE LOAD_REG_HOSPEDE_TEMPORARIO --
-------------------------------------------

CREATE PROCEDURE LOAD_REG_HOSPEDE_TEMPORARIO
(
    @P_COD_HOSPEDE_TEMPORARIO INT
)
AS
BEGIN
    SELECT
        TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO,        
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO,
        CONVERT(VARCHAR(10), TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO, 103) AS CHR_DATA_INICIO,
        TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM,
        CONVERT(VARCHAR(10), TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM, 103) AS CHR_DATA_FIM,
        TBL_HOSPEDE_TEMPORARIO.CHR_EVENTO,
        TBL_HOSPEDE_TEMPORARIO.CHR_RESPONSAVEL,
        TBL_HOSPEDE_TEMPORARIO.CHR_CONTATO,
        TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PESSOAS,
        TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PERNOITE,
        TBL_HOSPEDE_TEMPORARIO.FLT_VALOR,
        TBL_HOSPEDE_TEMPORARIO.CHR_SITUACAO,
        TBL_HOSPEDE_TEMPORARIO.CHR_OBSERVACAO
    FROM
        TBL_HOSPEDE_TEMPORARIO   
    WHERE
        TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO = @P_COD_HOSPEDE_TEMPORARIO
END

----------------------------------------
-- PROCEDURE INSERT_HOSPEDE_TEMPORARIO --
----------------------------------------

CREATE PROCEDURE INSERT_HOSPEDE_TEMPORARIO
(
    @P_COD_HOSPEDE_TEMPORARIO INT,
    @P_DT_DATA_INICIO SMALLDATETIME,
    @P_DT_DATA_FIM SMALLDATETIME,
    @P_CHR_EVENTO VARCHAR(256),
    @P_CHR_RESPONSAVEL VARCHAR(256),
    @P_CHR_CONTATO VARCHAR(256),
    @P_INT_QUANTIDADE_PESSOAS INT,
    @P_INT_QUANTIDADE_PERNOITE INT,
    @P_FLT_VALOR NUMERIC(10,2),
    @P_CHR_SITUACAO VARCHAR(256),
    @P_CHR_OBSERVACAO VARCHAR(256)
)
AS
BEGIN
    IF
    (
        SELECT
            COUNT(*)
        FROM
            TBL_HOSPEDE_TEMPORARIO
        WHERE
            TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO = @P_COD_HOSPEDE_TEMPORARIO
    ) > 0
    BEGIN
        UPDATE
            TBL_HOSPEDE_TEMPORARIO
        SET             
            TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO = @P_DT_DATA_INICIO,
            TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM = @P_DT_DATA_FIM,
            TBL_HOSPEDE_TEMPORARIO.CHR_EVENTO = @P_CHR_EVENTO,
            TBL_HOSPEDE_TEMPORARIO.CHR_RESPONSAVEL = @P_CHR_RESPONSAVEL,
            TBL_HOSPEDE_TEMPORARIO.CHR_CONTATO = @P_CHR_CONTATO,
            TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PESSOAS = @P_INT_QUANTIDADE_PESSOAS,
            TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PERNOITE =  @P_INT_QUANTIDADE_PERNOITE,
            TBL_HOSPEDE_TEMPORARIO.FLT_VALOR = @P_FLT_VALOR,
            TBL_HOSPEDE_TEMPORARIO.CHR_SITUACAO = @P_CHR_SITUACAO,
            TBL_HOSPEDE_TEMPORARIO.CHR_OBSERVACAO = @P_CHR_OBSERVACAO
        WHERE
            TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO = @P_COD_HOSPEDE_TEMPORARIO
    END
    ELSE
    BEGIN
        INSERT INTO TBL_HOSPEDE_TEMPORARIO
        (   
            TBL_HOSPEDE_TEMPORARIO.DT_DATA_INICIO,
            TBL_HOSPEDE_TEMPORARIO.DT_DATA_FIM,
            TBL_HOSPEDE_TEMPORARIO.CHR_EVENTO,
            TBL_HOSPEDE_TEMPORARIO.CHR_RESPONSAVEL,
            TBL_HOSPEDE_TEMPORARIO.CHR_CONTATO,
            TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PESSOAS,
            TBL_HOSPEDE_TEMPORARIO.INT_QUANTIDADE_PERNOITE,
            TBL_HOSPEDE_TEMPORARIO.FLT_VALOR,
            TBL_HOSPEDE_TEMPORARIO.CHR_SITUACAO,
            TBL_HOSPEDE_TEMPORARIO.CHR_OBSERVACAO
        )
        VALUES
        (
            @P_DT_DATA_INICIO,
            @P_DT_DATA_FIM,
            @P_CHR_EVENTO,
            @P_CHR_RESPONSAVEL,
            @P_CHR_CONTATO,
            @P_INT_QUANTIDADE_PESSOAS,
            @P_INT_QUANTIDADE_PERNOITE,
            @P_FLT_VALOR,
            @P_CHR_SITUACAO,
            @P_CHR_OBSERVACAO
        )
    END    
END

----------------------------------------
-- PROCEDURE DELETE_HOSPEDE_TEMPORARIO --
----------------------------------------

CREATE PROCEDURE DELETE_HOSPEDE_TEMPORARIO
(
    @P_COD_HOSPEDE_TEMPORARIO INT
)
AS
BEGIN
    
    DELETE
		TBL_HOSPEDE_TEMPORARIO
	WHERE
		TBL_HOSPEDE_TEMPORARIO.COD_HOSPEDE_TEMPORARIO = @P_COD_HOSPEDE_TEMPORARIO
	
	-- MENSAGEM DE RETORNO	
	SELECT '' AS P_CHR_MSG_ERRO
	
END
